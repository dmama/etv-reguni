<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- Transaction manager -->
	<bean id="transactionManager" class="ch.vd.uniregctb.transaction.TransactionManagerFactoryBean">
		<property name="defaultTransactionTimeoutSeconds" value="86400" />
	</bean>

	<bean id="jmsConnectionFactory" class="org.apache.activemq.pool.XaPooledConnectionFactory" init-method="start" destroy-method="stop">
		<property name="connectionFactory">
			<bean class="org.apache.activemq.ActiveMQXAConnectionFactory">
				<property name="brokerURL" ref="esbUrl" />
				<property name="userName" ref="esbUsername" />
				<property name="password" ref="esbPassword" />
			</bean>
		</property>
		<property name="maxConnections" value="50" />
		<property name="transactionManager" ref="transactionManager" />
	</bean>

	<bean id="jmsResourceAdapter" class="org.springframework.jca.support.ResourceAdapterFactoryBean">
		<property name="resourceAdapter">
			<bean class="org.apache.activemq.ra.ActiveMQResourceAdapter">
				<property name="serverUrl" ref="esbUrl" />
				<property name="userName" ref="esbUsername" />
				<property name="password" ref="esbPassword" />
			</bean>
		</property>
		<property name="workManager">
			<bean class="org.springframework.jca.work.SimpleTaskWorkManager" />
		</property>
	</bean>

	<bean id="esbJmsTemplate" class="ch.vd.technical.esb.jms.EsbJmsTemplate" lazy-init="true">
		<property name="connectionFactory" ref="jmsConnectionFactory" />
		<property name="esbStore" ref="zipRaftEsbStore" />
		<property name="receiveTimeout" value="1000" />
		<property name="application" value="unireg" />
		<property name="domain" value="fiscalite" />
	</bean>

	<bean id="zipRaftEsbStore" class="ch.vd.technical.esb.store.raft.ZipRaftEsbStore">
		<property name="store">
			<bean class="ch.vd.technical.esb.store.raft.RaftEsbStore">
				<property name="endpoint" ref="raftUrl" />
			</bean>
		</property>
	</bean>

</beans>
