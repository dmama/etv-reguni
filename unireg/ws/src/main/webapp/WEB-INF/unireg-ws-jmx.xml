<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jee="http://www.springframework.org/schema/jee"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
							http://www.springframework.org/schema/beans/spring-beans.xsd
        					http://www.springframework.org/schema/beans
							http://www.springframework.org/schema/beans/spring-beans.xsd
							http://www.springframework.org/schema/jee
							http://www.springframework.org/schema/jee/spring-jee-2.0.xsd">

	<!-- Read management interface from annotations -->
	<bean id="jmxAttributeSource" class="org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource" />
	<bean id="jmxAssembler" class="org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler">
		<property name="attributeSource" ref="jmxAttributeSource" />
	</bean>

	<!--
		   Object name is built from annotations (@ManagedResource), then
		   fallbacked to bean key
	   -->
	<bean id="jmxNamingStrategy" class="org.springframework.jmx.export.naming.MetadataNamingStrategy">
		<property name="attributeSource" ref="jmxAttributeSource" />
	</bean>

	<bean id="jmxExporter" class="org.springframework.jmx.export.MBeanExporter">
		<property name="autodetect" value="false" />
		<!-- We specify the beans ourselves -->
		<property name="assembler" ref="jmxAssembler" />
		<property name="namingStrategy" ref="jmxNamingStrategy" />
		<property name="beans">
			<map>
				<entry key="ch.vd.uniregctb-ws:type=Monitoring,name=Application" value="applicationMonitoringJmxBean" />
				<entry key="ch.vd.uniregctb-ws:type=Connections,name=Oracle" value="oracleConnectionJmxBean" />
				<!--<entry key="ch.vd.regcdh:type=Connections,name=DB2" value="db2ConnectionJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Connections,name=HostInterface" value="hostInterfaceConnectionJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Connections,name=RefInf" value="refinfConnectionJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=MigrationMini" value="migrationMiniJobJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=MigrationFull" value="migrationFullJobJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=CoSousEtatClarifier" value="coSousEtatClarifierJobJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=Communication" value="communicationJobJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=Fea2RegPPLoader" value="fea2RegPPLoaderJobJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=PurgeAssignation" value="purgeAssignationJobJmxBean" />-->
				<!--<entry key="ch.vd.regcdh:type=Jobs,name=RetourNumerosIndividus" value="retourNumerosIndividusJobJmxBean" />-->
				<entry key="ch.vd.uniregctb-ws:type=Properties,name=Preferences" value="preferencesPropertiesJmxBean" />
				<entry key="ch.vd.uniregctb-ws:type=Properties,name=Others" value="othersPropertiesJmxBean" />
			</map>
		</property>
	</bean>

	<bean name="applicationMonitoringJmxBean" class="ch.vd.uniregctb.jmx.ApplicationMonitoringJMXBeanImpl">
		<property name="checker" ref="applicationChecker" />
	</bean>

	<bean name="oracleConnectionJmxBean" class="ch.vd.registre.jmx.ConnectionJmxBeanImpl">
		<constructor-arg ref="dataSource" />
	</bean>

	<bean name="preferencesPropertiesJmxBean" class="ch.vd.registre.jmx.PropertiesJmxBeanImpl">
		<constructor-arg ref="uniregExternalProperties" />
		<constructor-arg><bean class="ch.vd.uniregctb.utils.UniregProperties$UniregPropertiesAdapterFactoryBean"/></constructor-arg>
	</bean>

	<bean name="othersPropertiesJmxBean" class="ch.vd.registre.jmx.PropertiesJmxBeanImpl">
		<constructor-arg>
			<map>
				<entry key="applicationVersion" value="${pom.version}" />
				<entry key="encoding" value="${file.encoding}" />
				<entry key="java_vm_vendor" value="${java.vm.vendor}" />
				<entry key="java_vm_name" value="${java.vm.name}" />
				<entry key="java_specification_version" value="${java.specification.version}" />
				<entry key="os_arch" value="${os.arch}" />
				<entry key="os_name" value="${os.name}" />
				<entry key="os_version" value="${os.version}" />
			</map>
		</constructor-arg>
	</bean>

</beans>
