<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
	http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd">
	
	<bean id="appInfo" class="ch.vd.uniregctb.common.ApplicationInfo">
		<property name="name" value="${pom.name}" />
		<property name="version" value="${pom.version}" />
		<property name="description" value="${pom.description}" />
	</bean>

	<bean id="statsService" class="ch.vd.uniregctb.stats.StatsService">
	</bean>

	<bean id="globalTiersIndexer" class="ch.vd.uniregctb.indexer.tiers.GlobalTiersIndexerImpl">
		<property name="globalIndex" ref="globalIndex" />
		<property name="tiersSearcher" ref="globalTiersSearcher" />
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="serviceCivilService" ref="serviceCivilService" />
		<property name="serviceInfra" ref="serviceInfrastructureService" />
		<property name="serviceCivilApireg" ref="serviceCivilApireg" />
		<property name="adresseService" ref="adresseService" />
		<property name="tiersService" ref="tiersService" />
		<property name="transactionManager" ref="transactionManager" />
		<property name="sessionFactory"  ref="sessionFactory"/>
	</bean>

	<bean id="officeImpotIndexer" class="ch.vd.uniregctb.indexer.tiers.OfficeImpotIndexerImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="oidInterceptor" ref="officeImpotHibernateInterceptor" />
		<property name="transactionManager" ref="transactionManager" />
		<property name="tiersIndexer" ref="globalTiersIndexer" />
		<property name="validationInterceptor" ref="validationInterceptor" />
	</bean>
	
	<bean id="indexingHibernateInterceptor" class="ch.vd.uniregctb.indexer.tiers.TiersIndexerHibernateInterceptor">
		<property name="parent" ref="modificationInterceptor" />
		<property name="indexer" ref="globalTiersIndexer" />
		<property name="sessionFactory"  ref="sessionFactory"/>
	</bean>

 	<bean id="officeImpotHibernateInterceptor" class="ch.vd.uniregctb.indexer.tiers.OfficeImpotHibernateInterceptor">
		<property name="chainingInterceptor" ref="chainingInterceptor" />
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
		<property name="tacheDAO" ref="tacheDAO" />
	</bean>
	 
	<bean id="globalTiersSearcher" class="ch.vd.uniregctb.indexer.tiers.GlobalTiersSearcherImpl">
		<property name="globalIndex" ref="globalIndex" />
		<property name="parametreAppService" ref="parametreAppService" />
	</bean>

	<bean id="tiersService" class="ch.vd.uniregctb.tiers.TiersServiceImpl">
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="tacheDAO" ref="tacheDAO" />
		<property name="evenementCivilRegroupeDAO" ref="evenementCivilRegroupeDAO" />
		<property name="tiersSearcher" ref="globalTiersSearcher" />
		<property name="serviceCivilService" ref="serviceCivilService" />
		<property name="serviceInfra" ref="serviceInfrastructureService" />
		<property name="tacheService" ref="tacheService" />
		<property name="situationFamilleService" ref="situationFamilleService" />
		<property name="evenementFiscalService">
			<ref local="evenementFiscalService" />
		</property>
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="transactionManager" ref="transactionManager" />
		<property name="adresseService" ref="adresseService" />
	</bean>

	<bean id="metierService" class="ch.vd.uniregctb.metier.MetierServiceImpl">
		<property name="transactionManager" ref="transactionManager" />
		<property name="serviceCivilService" ref="serviceCivilService" />
		<property name="infrastructureService" ref="serviceInfrastructureService" />
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="tiersService" ref="tiersService" />
		<property name="adresseService" ref="adresseService" />
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="situationFamilleService" ref="situationFamilleService" />
		<property name="tiersSearcher" ref="globalTiersSearcher" />
	</bean>

	<bean id="tacheService" class="ch.vd.uniregctb.tache.TacheServiceImpl">
		<property name="tacheDAO" ref="tacheDAO" />
		<property name="diDAO" ref="diDAO" />
		<property name="diService" ref="diService" />
		<property name="parametres" ref="parametreAppService" />
		<property name="serviceInfra" ref="serviceInfrastructureService" />
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="transactionManager" ref="transactionManager" />
		<property name="tiersService" ref="tiersService" />
	</bean>

	<bean id="adresseService" class="ch.vd.uniregctb.adresse.AdresseServiceImpl">
		<property name="tiersService" ref="tiersService" />
		<property name="serviceCivilService" ref="serviceCivilService" />
		<property name="serviceInfra" ref="serviceInfrastructureService" />
		<property name="servicePM" ref="servicePersonneMoraleService" />
	</bean>

	<bean id="evenementService" class="ch.vd.uniregctb.evenement.EvenementServiceImpl">
		<property name="evenementCivilRegroupeDAO" ref="evenementCivilRegroupeDAO" />
	</bean>
	
	<bean id="ibanValidator" class="ch.vd.uniregctb.iban.IbanValidator">
		<property name="clearingDao" ref="clearingDaoProperties" />
	</bean>

	<bean id="clearingDaoProperties" class="ch.vd.uniregctb.iban.ClearingDaoProperties"/>

	<bean id="scheduler" class="ch.vd.uniregctb.scheduler.OverrideSchedulerFactoryBean">
		<property name="schedulerName" value="schedulerQuartz" />
	</bean>
	
	<bean id="batchScheduler" class="ch.vd.uniregctb.scheduler.BatchScheduler">
		<property name="scheduler" ref="scheduler" />
	</bean>

	<bean id="globalIndexRaw" class="ch.vd.uniregctb.indexer.GlobalIndex">
		<constructor-arg ref="fileGlobalIndexDirectory" />
	</bean>

	<bean id="globalIndexTracing" class="ch.vd.uniregctb.indexer.GlobalIndexTracing">
		<property name="target" ref="globalIndexRaw" />
	</bean>

	<alias alias="globalIndex" name="globalIndexTracing"/>

	<bean id="dbGlobalIndexDirectory" class="ch.vd.uniregctb.indexer.jdbc.JdbcDirectoryProvider" lazy-init="true">
		<constructor-arg ref="dataSource" />
		<constructor-arg value="LUCENE_IDX" />
	</bean>

	<bean id="lrService" class="ch.vd.uniregctb.declaration.source.ListeRecapServiceImpl" lazy-init="true">
		<property name="editiqueService" ref="editiqueService" />
		<property name="evenementFiscalService" ref="evenementFiscalService" />
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="periodeDAO" ref="periodeFiscaleDAO" />
		<property name="listeRecapDAO" ref="lrDAO" />
		<property name="modeleDocumentDAO" ref="modeleDocumentDAO" />
		<property name="delaisService" ref="delaisService" />
		<property name="transactionManager" ref="transactionManager" />
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>

	<bean id="diService" class="ch.vd.uniregctb.declaration.ordinaire.DeclarationImpotServiceImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="transactionManager" ref="transactionManager" />
		<property name="editiqueService" ref="editiqueService" />
		<property name="impressionDIHelper" ref="impressionDIHelper" />
		<property name="impressionSommationDIHelper" ref="impressionSommationDIHelper" />
		<property name="periodeDAO" ref="periodeFiscaleDAO" />
		<property name="tacheDAO" ref="tacheDAO" />
		<property name="modeleDAO" ref="modeleDocumentDAO" />
		<property name="diDAO" ref="diDAO" />
		<property name="evenementFiscalService" ref="evenementFiscalService" />
		<property name="delaisService" ref="delaisService" />
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
		<property name="parametres" ref="parametreAppService" />
	</bean>

	<bean id="roleService" class="ch.vd.uniregctb.role.RoleServiceImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
		<property name="tiersDAO" ref="tiersDAO"/>
		<property name="transactionManager" ref="transactionManager"/>
		<property name="adresseService" ref="adresseService"/>
		<property name="serviceCivilService" ref="serviceCivilService" />
	</bean>
	
	<bean id="listesTiersService" class="ch.vd.uniregctb.listes.ListesTiersServiceImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate"/>
		<property name="tiersService" ref="tiersService"/>
		<property name="adresseService" ref="adresseService"/>
		<property name="transactionManager" ref="transactionManager"/>
		<property name="tiersDAO" ref="tiersDAO"/>
		<property name="infraService" ref="serviceInfrastructureService"/>
	</bean>

	<bean id="acomptesService" class="ch.vd.uniregctb.acomptes.AcomptesServiceImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate"/>
		<property name="tiersService" ref="tiersService"/>
		<property name="adresseService" ref="adresseService"/>
		<property name="transactionManager" ref="transactionManager"/>
		<property name="tiersDAO" ref="tiersDAO"/>
	</bean>

	<!-- Database service -->
	<bean id="databaseService" class="ch.vd.uniregctb.database.DatabaseServiceImpl">
		<property name="localSessionFactoryBean" ref="&amp;sessionFactory" />
		<property name="dataSource" ref="dataSource" />
		<property name="transactionManager" ref="transactionManager" />
	</bean>

	<bean id="databaseChangeInterceptor" class="ch.vd.uniregctb.database.DatabaseChangeInterceptor">
		<property name="parent" ref="modificationInterceptor" />
		<property name="dbService" ref="databaseService" />
	</bean>

	<!-- Section Evenement Fiscal -->
	<bean id="evenementFiscalService" class="ch.vd.uniregctb.evenement.fiscal.EvenementFiscalServiceImpl">
		<property name="evenementFiscalDAO" ref="evenementFiscalDAO" />
		<property name="evenementFiscalFacade" ref="evenementFiscalFacade" />
		<property name="parametres" ref="parametreAppService" />
	</bean>

	<!-- Section Evenement Externe -->
	<bean id="evenementExterneService" class="ch.vd.uniregctb.evenement.externe.EvenementExterneServiceImpl" lazy-init="true">
		<property name="evenementExterneFacade" ref="evenementExterneFacade" />
	</bean>
	
	<bean id="evenementExterneListener" class="ch.vd.uniregctb.evenement.externe.EvenementExterneListenerImpl" lazy-init="true">
		<property name="evenementExterneDAO" ref="evenementExterneDAO" />
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="databaseService" ref="databaseService"/>
	</bean>

	<bean id="rapportService" class="ch.vd.uniregctb.rapport.RapportServiceImpl">
		<property name="adresseService" ref="adresseService" />
		<property name="docService" ref="docService" />
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
	</bean>
	
	<bean id="situationFamilleService" class="ch.vd.uniregctb.situationfamille.SituationFamilleServiceImpl">
		<property name="serviceCivil" ref="serviceCivilService" />
		<property name="tiersService" ref="tiersService" />
		<property name="situationFamilleDAO" ref="situationFamilleDAO" />
		<property name="evenementFiscalService" ref="evenementFiscalService" />
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="transactionManager" ref="transactionManager"/>
	</bean>
	
	<!--  Paramètres -->
	<bean id="parametreAppService" class="ch.vd.uniregctb.parametrage.ParametreAppServiceImpl">
		<property name="dao" ref="parametreAppDAO" />
	</bean>
	
	<bean id="joursFeriesProvider" class="ch.vd.uniregctb.parametrage.JoursFeriesProviderImpl">
		<property name="parametreAppService" ref="parametreAppService" />
	</bean>
	
	<bean id="delaisService" class="ch.vd.uniregctb.parametrage.DelaisServiceImpl">
		<property name="joursFeriesProvider" ref="joursFeriesProvider" />
		<property name="parametreAppService" ref="parametreAppService" />
	</bean>
	
	<bean id="periodeFiscaleService" class="ch.vd.uniregctb.parametrage.PeriodeFiscaleServiceImpl">
		<property name="dao" ref="periodeFiscaleDAO" />
		<property name="parametreAppService" ref="parametreAppService" />
	</bean>

	<bean id="droitAccesService" class="ch.vd.uniregctb.security.DroitAccesServiceImpl">
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="droitAccesDAO" ref="droitAccesDAO" />
	</bean>

	<bean id="identCtbService" class="ch.vd.uniregctb.identification.contribuable.IdentificationContribuableServiceImpl" lazy-init="true">
		<property name="searcher" ref="globalTiersSearcher" />
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="identCtbDAO" ref="identCtbDAO" />
		<property name="tiersService" ref="tiersService" />
		<property name="adresseService" ref="adresseService" />
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="messageHandler" ref="identCtbMessageHandler" />
		<aop:scoped-proxy/>
	</bean>

	<!-- Helpers de toutes sortes et de tous lieux (Dieu y retrouvera les siens) -->

	<bean id="editiqueHelper" class="ch.vd.uniregctb.editique.impl.EditiqueHelperImpl">
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="adresseService" ref="adresseService" />
		<property name="tiersService" ref="tiersService" />		
	</bean>

	<bean id="impressionNouveauxDossiersHelper" class="ch.vd.uniregctb.tache.ImpressionNouveauxDossiersHelperImpl">
		<property name="serviceInfrastructureService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
		<property name="situationFamilleService" ref="situationFamilleService" />
		<property name="editiqueHelper" ref="editiqueHelper" />
	</bean>

	<bean id="impressionTaxationOfficeHelper" class="ch.vd.uniregctb.declaration.ordinaire.ImpressionTaxationOfficeHelperImpl">
		<property name="serviceInfrastructureService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
		<property name="situationFamilleService" ref="situationFamilleService" />
		<property name="editiqueHelper" ref="editiqueHelper" />
	</bean>

	<bean id="impressionDIHelper" class="ch.vd.uniregctb.declaration.ordinaire.ImpressionDeclarationImpotOrdinaireHelperImpl">
		<property name="infraService" ref="serviceInfrastructureService" />
		<property name="tiersService" ref="tiersService" />
		<property name="situationFamilleService" ref="situationFamilleService" />
			<property name="editiqueHelper" ref="editiqueHelper" />
		<property name="adresseService" ref="adresseService" />
	</bean>
	
	<bean id="impressionSommationDIHelper" class="ch.vd.uniregctb.declaration.ordinaire.ImpressionSommationDIHelperImpl">
		<property name="editiqueHelper" ref="editiqueHelper" />
		<property name="adresseService" ref="adresseService" />
		<property name="tiersService" ref="tiersService" />
		<property name="serviceInfrastructureService" ref="serviceInfrastructureService" />
		<property name="delaisService" ref="delaisService" />		 
	</bean>
	
	<bean id="impressionConfirmationDelaiHelper" class="ch.vd.uniregctb.declaration.ordinaire.ImpressionConfirmationDelaiHelperImpl">
		<property name="editiqueHelper" ref="editiqueHelper" />
		<property name="adresseService" ref="adresseService" />
	</bean>
	
	<bean id="uniregCacheManager" class="ch.vd.uniregctb.cache.UniregCacheManagerImpl">
	</bean>
	
	<bean id="printPCLService" class="ch.vd.uniregctb.editique.print.PrintPCLServiceImpl">
	</bean>

	<bean id="impressionLRHelper" class="ch.vd.uniregctb.declaration.source.ImpressionListeRecapHelperImpl">
		<property name="editiqueHelper" ref="editiqueHelper" />
		<property name="adresseService" ref="adresseService" />
		<property name="bvrPlusClient" ref="bvrPlusClient" />
	</bean>

	<bean id="impressionSommationLRHelper" class="ch.vd.uniregctb.declaration.source.ImpressionSommationLRHelperImpl">
		<property name="editiqueHelper" ref="editiqueHelper" />
		<property name="adresseService" ref="adresseService" />
		<property name="bvrPlusClient" ref="bvrPlusClient" />
	</bean>

	<bean id="activationService" class="ch.vd.uniregctb.activation.ActivationServiceImpl">
		<property name="tiersService" ref="tiersService" />
		<property name="tacheDAO" ref="tacheDAO" />
	</bean>
	
	<bean id="registreFoncierService" class="ch.vd.uniregctb.registrefoncier.RegistreFoncierServiceImpl"> 
		<property name="adresseService" ref="adresseService" />
		<property name="hibernateTemplate" ref="hibernateTemplate" />		
		<property name="transactionManager" ref="transactionManager"/>
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="situationFamilleService" ref="situationFamilleService" />
		<property name="serviceCivilService" ref="serviceCivilService" />
		<property name="tiersService" ref="tiersService"/>
	</bean>

	<bean id="mouvementService" class="ch.vd.uniregctb.mouvement.MouvementServiceImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="transactionManager" ref="transactionManager"/>
		<property name="tiersDAO" ref="tiersDAO" />
		<property name="tiersService" ref="tiersService"/>
		<property name="mouvementDossierDAO" ref="mouvementDossierDAO"/>
		<property name="editiqueService" ref="editiqueService"/>
	</bean>

	<bean id="impressionBordereauMouvementDossierHelper" class="ch.vd.uniregctb.mouvement.ImpressionBordereauMouvementDossierHelperImpl">
		<property name="editiqueHelper" ref="editiqueHelper"/>
		<property name="tiersService" ref="tiersService"/>
		<property name="infraService" ref="serviceInfrastructureService"/>
	</bean>

</beans>
