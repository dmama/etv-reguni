<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans	http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

	<!-- Petite bricole autour du tiersService, qui est passablement difficile à initialiser -->
	<!-- et dont on n'a clairement pas besoin de toute la complexité ici. -->
	<!-- On ne va donc laisser passer que certains appels vers la véritable implémentation, en faisant exploser les autres -->

	<bean id="_tiersService" class="ch.vd.uniregctb.tiers.TiersServiceImpl">
		<property name="bouclementService" ref="bouclementService"/>
		<property name="serviceOrganisationService" ref="serviceOrganisationService"/>
		<property name="assujettissementService" ref="assujettissementService"/>
		<!-- en théorie, il en manque plein... -->
	</bean>

	<bean id="tiersService" class="ch.vd.uniregctb.migration.pm.utils.TiersServiceFactory">
		<property name="target" ref="_tiersService"/>
		<property name="supportedMethodNames">
			<set>
				<value>getExercicesCommerciaux</value>
				<value>getPeriodesNonSocieteDePersonnes</value>
				<value>getCategorieEntreprise</value>
			</set>
		</property>
	</bean>

	<!-- Et maintenant, place aux services plus "traditionnels" -->

	<bean id="assujettissementService" class="ch.vd.uniregctb.metier.assujettissement.AssujettissementServiceImpl">
		<property name="validationService" ref="validationService"/>
		<property name="tiersService" ref="tiersService"/>
	</bean>

	<bean id="bouclementService" class="ch.vd.uniregctb.metier.bouclement.BouclementServiceImpl"/>

	<bean id="periodeImpositionService" class="ch.vd.uniregctb.metier.assujettissement.PeriodeImpositionServiceImpl">
		<property name="assujettissementService" ref="assujettissementService"/>
		<property name="tiersService" ref="tiersService"/>
		<property name="parametreAppService" ref="parametreAppService"/>
	</bean>

	<bean id="parametreAppService" class="ch.vd.uniregctb.parametrage.ParametreAppServiceImpl" depends-on="modificationLogInterceptor">
		<property name="transactionManager" ref="uniregTransactionManager"/>
		<property name="dao" ref="parametreAppDAO"/>
	</bean>

	<bean id="serviceOrganisationService" class="ch.vd.uniregctb.interfaces.service.ServiceOrganisationImpl">
		<property name="target" ref="serviceOrganisationRCEnt"/>
		<property name="serviceInfra" ref="serviceInfrastructureService"/>
	</bean>

	<bean id="serviceOrganisationRCEnt" class="ch.vd.unireg.interfaces.organisation.rcent.ServiceOrganisationRCEnt">
		<constructor-arg ref="rcentAdapter"/>
		<constructor-arg ref="serviceInfrastructureFidor"/>
	</bean>

	<bean id="rcentAdapter" class="ch.vd.uniregctb.adapter.rcent.service.RCEntAdapter">
		<constructor-arg name="rcentClient" ref="rcentClient"/>
		<constructor-arg name="historizer" ref="organisationHistorizer"/>
	</bean>

	<bean id="serviceInfrastructureFidor" class="ch.vd.unireg.interfaces.infra.fidor.ServiceInfrastructureFidor">
		<property name="fidorClient" ref="fidorClient"/>
		<property name="uniregCacheManager" ref="uniregCacheManager"/>
	</bean>

	<bean id="serviceInfrastructureService" class="ch.vd.uniregctb.interfaces.service.ServiceInfrastructureImpl">
		<property name="tiersDAO" ref="tiersDAO"/>
		<property name="rawService" ref="serviceInfrastructureFidor"/>
	</bean>

	<bean id="uniregCacheManager" class="ch.vd.uniregctb.migration.pm.utils.MockCacheManager"/>

</beans>