<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans	http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

	<bean id="migrationProgressMeasurement" class="ch.vd.uniregctb.migration.pm.engine.probe.ProgressMeasurementProbeImpl"/>
	<bean id="indexationProgressMeasurement" class="ch.vd.uniregctb.migration.pm.engine.probe.ProgressMeasurementProbeImpl"/>

	<bean id="migrator" class="ch.vd.uniregctb.migration.pm.Migrator">
		<property name="mode" value="DIRECT"/>
		<property name="feeder" ref="fromDbFeeder"/>
		<property name="worker" ref="migrationWorker"/>
		<property name="enabled" value="${migrator.enabled}"/>
	</bean>

	<bean id="alreadyMigratedEntrepriseIds" class="ch.vd.uniregctb.migration.pm.mapping.AlreadyMigratedEntrepriseListFactory">
		<property name="uniregTransactionManager" ref="uniregTransactionManager"/>
		<property name="uniregSessionFactory" ref="uniregSessionFactory"/>
	</bean>

	<bean id="fromDbFeeder" class="ch.vd.uniregctb.migration.pm.FromDbFeeder">
		<property name="regpmTransactionManager" ref="regpmTransactionManager"/>
		<property name="sessionFactory" ref="regpmSessionFactory"/>
		<property name="idsEntreprisesDejaMigrees" ref="alreadyMigratedEntrepriseIds"/>
		<property name="nomFichierIdentifiantsAExtraire" value="${migration.test.extracted.pm.file}"/>
		<property name="progressMonitor" ref="migrationProgressMeasurement"/>
	</bean>

</beans>
