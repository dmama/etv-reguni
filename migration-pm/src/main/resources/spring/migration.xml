<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans	http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

	<bean id="migrator" class="ch.vd.uniregctb.migration.pm.Migrator">
		<property name="mode" value="${migration.mode}"/>
		<property name="fromDbFeeder" ref="fromDbFeeder"/>
		<property name="serializationIntermediary" ref="serializationIntermediary"/>
		<property name="migrationWorker" ref="migrationWorker"/>
		<property name="enabled" value="${migrator.enabled}"/>
	</bean>

	<bean id="fromDbFeeder" class="ch.vd.uniregctb.migration.pm.FromDbFeeder">
		<property name="regpmTransactionManager" ref="regpmTransactionManager"/>
		<property name="sessionFactory" ref="regpmSessionFactory"/>
	</bean>

	<bean id="serializationIntermediary" class="ch.vd.uniregctb.migration.pm.SerializationIntermediary">
		<property name="fsDirectory" value="${migration.dump.dir}"/>
	</bean>

	<bean id="migrationWorker" class="ch.vd.uniregctb.migration.pm.MigrationWorker">
		<property name="streetDataMigrator" ref="streetDataMigrator"/>
		<property name="uniregTransactionManager" ref="uniregTransactionManager"/>
		<property name="uniregSessionFactory" ref="uniregSessionFactory"/>
		<property name="rcpersClient" ref="rcpersClient"/>
		<property name="rcentClient" ref="rcentClient"/>
		<property name="tiersDAO" ref="tiersDAO"/>
		<property name="nonHabitantIndex" ref="nonHabitantIndex"/>
		<property name="mode" value="${migration.mode}"/>
	</bean>

	<bean id="noOrdrePosteProvider" class="ch.vd.uniregctb.migration.pm.adresse.NoOrdrePosteProvider">
		<constructor-arg value="${mapping.noOrdreP.file}"/>
	</bean>

	<bean id="streetDataMigrator" class="ch.vd.uniregctb.migration.pm.adresse.StreetDataMigratorImpl">
		<property name="fidorClient" ref="fidorClient"/>
		<property name="mappingNosOrdrePoste" ref="noOrdrePosteProvider"/>
	</bean>

	<bean id="nonHabitantIndex" class="ch.vd.uniregctb.migration.pm.indexeur.NonHabitantIndex">
		<property name="index">
			<bean class="ch.vd.uniregctb.migration.pm.indexeur.IndexImpl">
				<constructor-arg name="indexPath" value="${indexeur.nh.dir}"/>
			</bean>
		</property>
	</bean>

	<bean id="migrationInitializer" class="ch.vd.uniregctb.migration.pm.MigrationInitializer">
		<property name="nonHabitantIndex" ref="nonHabitantIndex"/>
		<property name="nonHabitantIndexToBeCleared" value="${indexeur.nh.create}"/>
		<property name="registrar" ref="migrator"/>
		<property name="uniregTransactionManager" ref="uniregTransactionManager"/>
		<property name="uniregSessionFactory" ref="uniregSessionFactory"/>
	</bean>

</beans>
